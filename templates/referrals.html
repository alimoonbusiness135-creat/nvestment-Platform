{% extends 'base.html' %}

{% block title %}Referrals - Investment Platform{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Referral Program</h1>
    <p class="text-muted">Earn commissions from your referrals' deposits</p>
</div>

<div class="deposit-form-container">
    <div class="card">
        <div class="card-header">
            <h3 class="mb-0">Your Referral Link</h3>
        </div>
        <div class="card-body">
            <p>Share this link with your friends and earn commissions when they deposit:</p>

            <div class="referral-link-container">
                <div class="referral-link" id="referral-link">{{ referral_link }}</div>
                <button class="copy-btn" id="copy-referral-link">Copy</button>
            </div>

            <div class="alert alert-info mt-3">
                <h4 class="alert-heading">How it works:</h4>
                <p>Our 3-level referral program allows you to earn commissions from your direct and indirect referrals:
                </p>
                <ul>
                    <li><strong>Level 1 (Direct):</strong> Earn 5% commission on deposits from users you directly refer
                    </li>
                    <li><strong>Level 2:</strong> Earn 2% commission on deposits from users referred by your direct
                        referrals</li>
                    <li><strong>Level 3:</strong> Earn 1% commission on deposits from users referred by your level 2
                        referrals</li>
                </ul>
                <p class="mb-0">Commissions are automatically added to your earning balance when your referrals make
                    deposits.</p>
            </div>
        </div>
    </div>

    <div class="row" style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 24px;">
        <div class="col" style="flex: 1; min-width: 300px;">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">Referral Statistics</h3>
                </div>
                <div class="card-body">
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-card-value">{{ referral_stats.level1 }}</div>
                            <div class="stat-card-title">Level 1 Referrals</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-value">{{ referral_stats.level2 }}</div>
                            <div class="stat-card-title">Level 2 Referrals</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-value">{{ referral_stats.level3 }}</div>
                            <div class="stat-card-title">Level 3 Referrals</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-value">${{ total_referral_earnings|round(2) }}</div>
                            <div class="stat-card-title">Total Earnings</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col" style="flex: 1; min-width: 300px;">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">Promotional Materials</h3>
                </div>
                <div class="card-body">
                    <p>Use these promotional materials to share on your social media:</p>

                    <div class="promo-materials"
                        style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;">
                        <!-- Banner 1: Gold & Forex -->
                        <div class="promo-item-css"
                            style="flex: 1; min-width: 280px; height: 180px; border-radius: 12px; overflow: hidden; position: relative; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,215,0,0.3); box-shadow: 0 10px 20px rgba(0,0,0,0.2);">
                            <div
                                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 20% 30%, rgba(255,215,0,0.15) 0%, transparent 50%);">
                            </div>
                            <div
                                style="padding: 20px; position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; justify-content: center;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div
                                        style="width: 40px; height: 40px; background: #ffd700; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px rgba(255,215,0,0.5); animation: pulse-gold 2s infinite;">
                                        <i class="fas fa-chart-line" style="color: #000; font-size: 20px;"></i>
                                    </div>
                                    <h4 style="margin: 0; font-size: 18px; color: #fff; font-weight: 700;">PRO TRADING
                                    </h4>
                                </div>
                                <p style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 15px;">Earn 2%
                                    Daily Profits on Gold & Forex pairs.</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span
                                        style="background: rgba(255,215,0,0.2); color: #ffd700; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">LEVEL
                                        3 REWARDS</span>
                                    <button class="btn btn-sm btn-link p-0 text-white"
                                        style="text-decoration: underline; font-size: 12px;">DOWNLOAD KIT</button>
                                </div>
                            </div>
                            <div
                                style="position: absolute; bottom: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,215,0,0.05); border-radius: 50%; border: 1px solid rgba(255,215,0,0.2);">
                            </div>
                        </div>

                        <!-- Banner 2: Global Growth -->
                        <div class="promo-item-css"
                            style="flex: 1; min-width: 280px; height: 180px; border-radius: 12px; overflow: hidden; position: relative; background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); border: 1px solid rgba(99,102,241,0.3); box-shadow: 0 10px 20px rgba(0,0,0,0.2);">
                            <div
                                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 80% 70%, rgba(99,102,241,0.2) 0%, transparent 60%);">
                            </div>
                            <div
                                style="padding: 20px; position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; justify-content: center;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div
                                        style="width: 40px; height: 40px; background: #6366f1; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px rgba(99,102,241,0.5); animation: pulse-blue 2s infinite;">
                                        <i class="fas fa-globe-americas" style="color: #fff; font-size: 20px;"></i>
                                    </div>
                                    <h4 style="margin: 0; font-size: 18px; color: #fff; font-weight: 700;">GLOBAL IMPACT
                                    </h4>
                                </div>
                                <p style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 15px;">Join 1M+
                                    Users in our Global Investment Network.</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span
                                        style="background: rgba(99,102,241,0.2); color: #818cf8; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">AI
                                        ANALYTICS FREE</span>
                                    <button class="btn btn-sm btn-link p-0 text-white"
                                        style="text-decoration: underline; font-size: 12px;">DOWNLOAD KIT</button>
                                </div>
                            </div>
                            <div
                                style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; background: rgba(99,102,241,0.05); border-radius: 50%; border: 1px solid rgba(99,102,241,0.1);">
                            </div>
                        </div>
                    </div>

                    <style>
                        @keyframes pulse-gold {
                            0% {
                                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
                            }

                            70% {
                                box-shadow: 0 0 0 15px rgba(255, 215, 0, 0);
                            }

                            100% {
                                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0);
                            }
                        }

                        @keyframes pulse-blue {
                            0% {
                                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7);
                            }

                            70% {
                                box-shadow: 0 0 0 15px rgba(99, 102, 241, 0);
                            }

                            100% {
                                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
                            }
                        }

                        .promo-item-css {
                            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                            cursor: pointer;
                        }

                        .promo-item-css:hover {
                            transform: translateY(-5px) scale(1.02);
                        }
                    </style>

                    <h4>Sample Message:</h4>
                    <div class="form-group">
                        <textarea class="form-control" rows="4"
                            readonly>Join the investment platform where you can earn 2% daily returns on your investments! Use my referral link to get started: {{ referral_link }}</textarea>
                        <button class="btn btn-secondary btn-sm mt-2">Copy Message</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h3 class="mb-0">Your Direct Referrals</h3>
        </div>
        <div class="card-body">
            {% if direct_referrals %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Join Date</th>
                            <th>Deposits</th>
                            <th>Commission Earned</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for referral in direct_referrals %}
                        <tr>
                            <td>{{ referral.username }}</td>
                            <td>{{ referral.created_at.strftime('%Y-%m-%d') }}</td>
                            <td>${{ referral.deposit_balance|round(2) }}</td>
                            <td>${{ (referral.deposit_balance * 0.05)|round(2) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info">
                <p>You don't have any direct referrals yet. Share your referral link to start earning commissions!</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h3 class="mb-0">Referral Earnings History</h3>
        </div>
        <div class="card-body">
            {% if referral_earnings %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Amount</th>
                            <th>Level</th>
                            <th>User</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for earning in referral_earnings %}
                        <tr>
                            <td>${{ earning.commission|round(2) }}</td>
                            <td>Level {{ earning.level }}</td>
                            <td>
                                {% set referred_user = referred_users.get(earning.referred_id) %}
                                {% if referred_user %}
                                {{ referred_user.username }}
                                {% else %}
                                User #{{ earning.referred_id }}
                                {% endif %}
                            </td>
                            <td>{{ earning.created_at.strftime('%Y-%m-%d') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info">No referral earnings recorded yet.</div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}