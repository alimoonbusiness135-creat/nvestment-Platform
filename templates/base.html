<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Investment Platform{% endblock %}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono&family=Product+Sans:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/flash-messages.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    {% block styles %}{% endblock %}
</head>

<body>
    <!-- Navigation -->
    {% if current_user.is_authenticated %}
    {% include 'partials/navbar.html' %}
    {% endif %}

    <!-- Flash Messages Container -->
    <div class="flash-messages" id="flashMessages"></div>

    <!-- Main Content -->
    <div class="container {% if current_user.is_authenticated %}mt-5{% endif %}">
        {% block content %}{% endblock %}
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-links">
                <a href="{{ url_for('index') }}" class="footer-link">Home</a>
                <a href="{{ url_for('about') }}" class="footer-link">About Us</a>
                <a href="{{ url_for('terms') }}" class="footer-link">Terms of Service</a>
                <a href="{{ url_for('privacy') }}" class="footer-link">Privacy Policy</a>
                <a href="{{ url_for('contact') }}" class="footer-link">Contact Us</a>
            </div>
            <div class="footer-copyright">
                &copy; {{ now.year }} Investment Platform. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/3d_effects.js') }}"></script>

    <!-- Flash Messages Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const flashMessages = document.getElementById('flashMessages');

            // Function to create flash message
            function createFlashMessage(message, category) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flash-message ${category}`;

                // Set icon based on category
                let icon;
                switch (category) {
                    case 'success':
                        icon = 'check_circle';
                        break;
                    case 'danger':
                        icon = 'error';
                        break;
                    case 'warning':
                        icon = 'warning';
                        break;
                    case 'deposit':
                        icon = 'account_balance';
                        break;
                    default:
                        icon = 'info';
                }

                // Special handling for deposit messages
                if (category === 'deposit') {
                    messageDiv.innerHTML = `
                        <span class="flash-message-icon material-icons-round">${icon}</span>
                        <div class="flash-message-content">
                            <div class="message-title">${message}</div>
                            <div class="message-action">
                                <a href="/deposit">
                                    <span class="material-icons-round">add_circle</span>
                                    Make a Deposit
                                </a>
                            </div>
                        </div>
                        <button class="flash-message-close">
                            <span class="material-icons-round">close</span>
                        </button>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <span class="flash-message-icon material-icons-round">${icon}</span>
                        <div class="flash-message-content">${message}</div>
                        <button class="flash-message-close">
                            <span class="material-icons-round">close</span>
                        </button>
                    `;
                }

                // Add close button functionality
                const closeBtn = messageDiv.querySelector('.flash-message-close');
                closeBtn.addEventListener('click', () => {
                    messageDiv.classList.add('hiding');
                    setTimeout(() => {
                        messageDiv.remove();
                    }, 300);
                });

                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.classList.add('hiding');
                        setTimeout(() => {
                            messageDiv.remove();
                        }, 300);
                    }
                }, 5000);

                return messageDiv;
            }

            // Process flash messages from Flask
            {% with messages = get_flashed_messages(with_categories = true) %}
            {% if messages %}
            {% for category, message in messages %}
            const message = createFlashMessage("{{ message|safe }}", "{{ category }}");
            flashMessages.appendChild(message);
            {% endfor %}
            {% endif %}
            {% endwith %}
        });
    </script>

    <!-- Material Ripple Effect -->
    <script>
        // Simple ripple effect for buttons
        document.addEventListener('DOMContentLoaded', function () {
            const buttons = document.querySelectorAll('.btn');

            buttons.forEach(button => {
                button.addEventListener('click', function (e) {
                    const x = e.clientX - e.target.getBoundingClientRect().left;
                    const y = e.clientY - e.target.getBoundingClientRect().top;

                    const ripple = document.createElement('span');
                    ripple.classList.add('ripple');
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';

                    this.appendChild(ripple);

                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });
        });
    </script>

    <!-- Level-based Animations -->
    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>

    {% block extra_js %}{% endblock %}
</body>

</html>