{% extends 'base.html' %}

{% block title %}Withdrawal - Investment Platform{% endblock %}

{% block content %}
<div class="dashboard-header animate-fade-in">
    <h1><i class="fas fa-credit-card"></i> Request Withdrawal</h1>
    <p class="text-muted"><i class="fas fa-info-circle"></i> Fast & Secure Withdrawal • 24-48 Hour Processing</p>
</div>

<div class="row g-4">
    <!-- Withdrawal Form -->
    <div class="col-lg-8">
        <div class="card card-highlight hover-lift animate-fade-in">
            <div class="mb-4">
                <h3 class="mb-0"><i class="fas fa-money-bill-wave"></i> Withdrawal Form</h3>
                <p class="text-muted mb-0">Withdraw your earnings securely</p>
            </div>

            <!-- Balance Alert -->
            <div class="alert alert-success border-0 rounded-3 mb-4" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-piggy-bank"></i> <strong>Available Balance</strong>
                        <p class="mb-0 text-muted">Ready to withdraw</p>
                    </div>
                    <div class="text-end">
                        <h3 class="mb-0" id="available-balance" data-balance="{{ current_user.earning_balance }}">${{ current_user.earning_balance|round(2) }}</h3>
                    </div>
                </div>
            </div>

            <form method="POST" action="{{ url_for('withdrawal') }}" id="withdrawal-form">
                <!-- Amount Input -->
                <div class="mb-4">
                    <label for="amount" class="form-label">
                        <i class="fas fa-dollar-sign"></i> Withdrawal Amount (USD)
                    </label>
                    <div class="input-group">
                        <span class="input-group-text" style="background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-light);">$</span>
                        <input type="number" class="form-control" id="amount" name="amount" min="30" step="5" max="5000" required placeholder="0.00">
                    </div>
                    <div id="amount-feedback" class="form-text text-danger"></div>
                    <small class="form-text text-muted">Minimum $30 • Maximum $5,000</small>
                </div>

                <!-- Payment Method -->
                <div class="mb-4">
                    <label for="payment_method" class="form-label">
                        <i class="fas fa-credit-card"></i> Payment Method
                    </label>
                    <select class="form-control" id="payment_method" name="payment_method" required>
                        <option value="">-- Select Payment Method --</option>
                        <option value="jazzcash">JazzCash (Mobile)</option>
                        <option value="easypaisa">EasyPaisa (Mobile)</option>
                        <option value="binance">Binance (BNB Smart Chain)</option>
                        <option value="bitget">BitGet (BNB Smart Chain)</option>
                    </select>
                </div>

                <!-- Account Details -->
                <div class="mb-4">
                    <label for="wallet_address" class="form-label">
                        <i class="fas fa-mobile-alt"></i> Phone Number / Wallet Address
                    </label>
                    <input type="text" class="form-control" id="wallet_address" name="wallet_address" required placeholder="Enter your phone number or wallet address">
                    <div id="wallet-feedback" class="form-text text-danger"></div>
                    <small class="form-text text-muted">⚠️ Double-check your details. We are not responsible for incorrect accounts.</small>
                </div>

                <button type="submit" class="btn btn-success btn-lg w-100">
                    <i class="fas fa-paper-plane"></i> Submit Withdrawal Request
                </button>
            </form>
        </div>

        <!-- Withdrawal Instructions -->
        <div class="card card-highlight hover-lift mt-4 animate-fade-in" style="animation-delay: 0.1s;">
            <h3 class="mb-3"><i class="fas fa-list-ol"></i> How It Works</h3>
            
            <div class="row g-3">
                <div class="col-md-6">
                    <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border-left: 4px solid var(--accent-green);">
                        <span class="badge badge-success mb-2">Step 1</span>
                        <p class="mb-0 small"><strong>Enter Amount</strong><br>Between $30-$5,000</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border-left: 4px solid var(--accent-green);">
                        <span class="badge badge-success mb-2">Step 2</span>
                        <p class="mb-0 small"><strong>Choose Method</strong><br>Select your payment option</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border-left: 4px solid var(--accent-green);">
                        <span class="badge badge-success mb-2">Step 3</span>
                        <p class="mb-0 small"><strong>Add Details</strong><br>Phone or wallet address</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border-left: 4px solid var(--accent-green);">
                        <span class="badge badge-success mb-2">Step 4</span>
                        <p class="mb-0 small"><strong>Get Paid</strong><br>24-48 hours processing</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Withdrawal History -->
        <div class="card card-highlight hover-lift animate-fade-in" style="animation-delay: 0.2s;">
            <h3 class="mb-3"><i class="fas fa-history"></i> Recent Withdrawals</h3>

            {% if withdrawals %}
            <div style="max-height: 400px; overflow-y: auto;">
                {% for withdrawal in withdrawals[:5] %}
                <div class="p-3 mb-2 rounded border border-opacity-25 hover-glow" style="background: rgba(255, 255, 255, 0.02);">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <h6 class="mb-1 fw-6">${{ withdrawal.amount|round(2) }}</h6>
                            <small class="text-muted">{{ withdrawal.payment_method|upper }}</small>
                        </div>
                        {% if withdrawal.status == 'pending' %}
                        <span class="badge badge-warning"><i class="fas fa-hourglass-half"></i> Pending</span>
                        {% elif withdrawal.status == 'approved' %}
                        <span class="badge badge-success"><i class="fas fa-check"></i> Approved</span>
                        {% elif withdrawal.status == 'rejected' %}
                        <span class="badge badge-danger"><i class="fas fa-times"></i> Rejected</span>
                        {% endif %}
                    </div>
                    <small class="text-muted">{{ withdrawal.created_at.strftime('%b %d, %Y %H:%M') }}</small>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-info border-0 rounded-2 py-3">
                <i class="fas fa-info-circle"></i> No withdrawals yet
            </div>
            {% endif %}
        </div>

        <!-- Important Info -->
        <div class="card border-0 mt-4" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 158, 11, 0.1)); border: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="card-body">
                <h5 class="mb-3"><i class="fas fa-exclamation-triangle"></i> Important</h5>
                <ul class="list-unstyled small" style="font-size: 0.85rem;">
                    <li class="mb-2"><i class="fas fa-check-circle" style="color: var(--accent-green);"></i> Minimum: $30</li>
                    <li class="mb-2"><i class="fas fa-check-circle" style="color: var(--accent-green);"></i> Maximum: $5,000</li>
                    <li class="mb-2"><i class="fas fa-check-circle" style="color: var(--accent-green);"></i> Processing: 24-48hrs</li>
                    <li class="mb-2"><i class="fas fa-check-circle" style="color: var(--accent-green);"></i> Double-check details</li>
                </ul>
            </div>
        </div>

        <!-- Security Info -->
        <div class="card border-0 mt-4" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));">
            <div class="card-body">
                <h5 class="mb-3"><i class="fas fa-shield-alt"></i> Security</h5>
                <ul class="list-unstyled small">
                    <li class="mb-2"><i class="fas fa-lock" style="color: var(--primary-light);"></i> Encrypted</li>
                    <li class="mb-2"><i class="fas fa-lock" style="color: var(--primary-light);"></i> 2FA Protected</li>
                    <li class="mb-2"><i class="fas fa-lock" style="color: var(--primary-light);"></i> Verified Methods</li>
                </ul>
            </div>
        </div>
    </div>
</div>

{% endblock %}